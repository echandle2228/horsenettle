---
title: "Sporophytic Tolerance Correlation"
author: "Emma Chandler"
date: "May 24, 2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load Libraries
```{r message=FALSE}
library(ggplot2)
library(plyr)
library(tidyverse)
library(ggcorrplot)
library(corrplot)
library(car)
```

# Clear environment and set seed
```{r}
remove(list = ls())
set.seed(158358)
```


# Load data
```{r}
H.CMS <- read.csv("~/Horsenettle/data/processed/H.CMS.csv", header = TRUE)
C.CMS <- read.csv("~/Horsenettle/data/processed/C.CMS.csv", header = TRUE)
H.CHPL <- read.csv("~/Horsenettle/data/processed/H.CHPL.csv", header = TRUE)
C.CHPL <- read.csv("~/Horsenettle/data/processed/C.CHPL.csv", header = TRUE)
CPS <- read.csv("~/Horsenettle/data/processed/CPS.csv", header = TRUE)
HPS <- read.csv("~/Horsenettle/data/processed/HPS.csv", header = TRUE)
```

### Rename column that are the same and convert lower to upper case
```{r}
H.CMS$HCMS <- H.CMS$CMS
C.CMS$CCMS <- C.CMS$CMS
H.CHPL$HCHPL <- H.CHPL$CHPL
C.CHPL$CCHPL <- C.CHPL$CHPL

HPS$ramet <- toupper(HPS$ramet)
CPS$ramet <- toupper(CPS$ramet)
```


### Drop columns that won't be used
```{r}

H.CMS <- H.CMS[-c(1,7,8:13)]
C.CMS <- C.CMS[-c(1,7,8:13)]
H.CHPL <- H.CHPL[-c(1,7,8:13)]
C.CHPL <- C.CHPL[-c(1,7,8:13)]
HPS <- HPS[-c(1,7)]
CPS <- CPS[-c(1,7)]
```

### Check column types
```{r}
summary(HPS)
summary(H.CMS)

```

# Test homogeneity of variance
```{r}
# Normal Data
bartlett.test(HCMS ~ location, data = H.CMS) #NS
bartlett.test(CCMS ~ location, data = C.CMS) #NS
bartlett.test(HCHPL ~ location, data = H.CHPL) # Variance significantly different
bartlett.test(CCHPL ~ location, data = C.CHPL) # Variance significantly different
bartlett.test(CPS ~ location, data = CPS) #NS
bartlett.test(HPS ~ location, data = HPS) #NS

# Non-normal data
leveneTest(HCMS ~ location, data = H.CMS) #NS
leveneTest(CCMS ~ location, data = C.CMS) #NS
leveneTest(HCHPL ~ location, data = H.CHPL) # Variance significantly different
leveneTest(CCHPL ~ location, data = C.CHPL) # Variance significantly different
leveneTest(CPS ~ location, data = CPS) #NS
leveneTest(HPS ~ location, data = HPS) #NS

```


# Create data frame with all tolerance variables
```{r}
CMS <- merge(H.CMS, C.CMS, by = c("ID", "location", "population", "number", "ramet"), all.x = FALSE, all = TRUE)
CHPL <- merge(H.CHPL, C.CHPL, by = c("ID", "location", "population", "number", "ramet"), all.x = FALSE, all = TRUE)
PS <- merge(HPS, CPS, by = c("ID", "location", "population", "number", "ramet"), all.x = FALSE, all = TRUE)
CC <- merge(CMS, CHPL, by = c("ID", "location", "population", "number", "ramet"), all.x = FALSE, all = TRUE)
ALL <- merge(CC, PS, by = c("ID", "location", "population", "number", "ramet"), all.x = TRUE, all = TRUE)

write.csv(x = ALL, file = "~/Horsenettle/data/processed/correlation.csv")

# Omit all except values of interest
COR <- ALL[-c(1:5)]

```

Changing column names for ease of reading in correlation plot
```{r}
names(COR)[1] <- "Hot CMS"  
names (COR)[2] <- "Cold CMS"
names (COR)[3] <- "Hot CHPL"
names (COR)[4] <- "Cold CHPL"
names (COR)[5] <- "Cold PS"
names (COR)[6] <- "Hot PS"
```


# Create correlation matrix
```{r}
correlation <- cor(COR, use = "pairwise.complete.obs")

head(correlation[, 1:6])

p.mat <- cor_pmat(COR)
head(p.mat[, 1:4])

```

```{r}
HStheme <- function(){            
  theme_bw()+                          
  theme(axis.text.x = element_text(size = 12), 
        text = element_text(family = "serif"), 
        axis.text.y = element_text(size = 12),
        plot.subtitle = element_text(size = 16, vjust = 1, hjust = 0.5),
        axis.title = element_text(size = 14),
        panel.grid = element_blank(),
        plot.margin = unit(c(0.5, 0.5, 0.5, 0.5), units = , "cm"),
        plot.title = element_text(size = 20, vjust = 1, hjust = 0.5),
        legend.text = element_text(size = 12),
        legend.title = element_blank())
}
```



# Create correlation heat map
```{r}

# ggcorrplot(correlation, hc.order = FALSE, outline.col = "white")
# 
# corrplot::corrplot(cor(correlation))


Corr <- corrplot(correlation, type="upper", order="hclust", 
         p.mat = p.mat, sig.level = 0.05, insig = "blank", addCoef.col ='black', tl.col = 'black')


# corrplot.mixed(correlation)
# 
# ggcorrplot(correlation, method = "circle", hc.order = TRUE)

```



## Create correlation plot matrix
```{r}

```
































